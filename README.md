Для работы, нужно разархивировать сsv-файлы из `Blitz.zip` в папку `raw_data`

___

https://contest.yandex.ru/contest/12899/problems/

# A. Система рекомендаций
В интернет-галерее пользователи могут просматривать тысячи картинок произвольного содержания. При этом они совершают различные действия, например кликают на картинку чтобы увеличить её в размере или отложить её в избранное. Имея такую информацию, часто можно предугадать дальнейшие действия пользователя, на чём и основано большинство современных систем рекомендаций.
В этой задаче вам предлагается создать свою собственную систему рекомендаций.
Имея идентификаторы картинок, с которыми пользователи взаимодействовали, вам нужно предсказать, на какие картинки пользователи вероятнее всего кликнут. При этом картинки, на которые пользователи совершали клики в прошлом, не будут участвовать в оценке, даже если на них будет повторно совершён клик в будущем. Для предсказания множество картинок включает в себя все идентификаторы, которые представлены в файлах.

## Формат ввода
Для данной задачи были собраны различные действия реальных пользователей за восемь недель. Далее для уменьшения размера данных мы выбрали 200000 случайных пользователей и оставили только их действия. Имея на руках соответствующие данные, вам нужно создать модель, позволяющую рекомендовать наиболее подходящие картинки для каждого из пользователей.
В этой задаче присутствуют различные данные, которые описывают действия пользователей на сервисе. Основным элементом интернет-галереи является картинка, которая может быть взята с любого интернет-ресурса, либо может быть создана пользователем.
Некоторые картинки могут принадлежать к различным тематикам, например «Еда» или «Природа».
Кроме самих действий пользователя вам также предоставлена информация о картинках и пользователях.

##### train_clicks.zip
Данный файл содержит информацию о кликах, сделанных пользователем по картинкам на сервисе.
```
user_id,picture_id,day  
1442,546149,2019-02-09  
1442,546149,2019-02-09  
1442,1242875,2019-02-16  
1442,1242875,2019-02-16  
1442,1242891,2019-02-16  
1442,1112678,2019-02-27  
1442,1217543,2019-02-27  
1442,478349,2019-03-04  
1442,1375623,2019-03-20
```
- user_id — идентификатор пользователя
- picture_id — идентификатор картинки
- day — день, в который был совершён клик

##### train_likes.zip

Данный файл содержит информацию о лайках, поставленных пользователем картинкам на сервисе.
```
user_id,picture_id,day  
490982,298754,2019-03-21  
490989,1060978,2019-02-17  
490989,976274,2019-02-17  
490989,976273,2019-02-17  
490989,976272,2019-02-17  
490989,976268,2019-02-17  
490989,976267,2019-02-17  
490989,976262,2019-02-17  
490989,976264,2019-02-17
```
- user_id — идентификатор пользователя
- picture_id — идентификатор картинки
- day — день, в который был поставлен лайк

##### train_shares.zip

Данный файл содержит информацию о картинках, отложенных пользователем в закладки.
```
user_id,picture_id,day  
24986,216354,2019-02-15  
25046,514369,2019-03-08  
25058,1066857,2019-02-05  
25058,481307,2019-02-05  
25058,636884,2019-02-05  
25058,997022,2019-02-07  
25058,80179,2019-02-08  
25058,985407,2019-02-10  
25058,646241,2019-02-13
```
- user_id — идентификатор пользователя
- picture_id — идентификатор картинки
- day — день, в который было совершено действие

##### picture_descriptions.zip

Данный файл содержит закодированное текстовое описание для большинства картинок.
```
picture_id,description  
1171496,734475 487260 884706 5941 48255 147285 969800  
1171497,488295 261184 466630 235887 642445 465419 929778 903862 438401 739693  
1171498,724435 1003828 164020  
1171499,274351 96637 259690 590856 761704 148158 165801 323108 242778 235887 476557  
1171500,235887 117104 952749 285126 288206  
1171502,96637 541022 399373 994844 607573 462602 142938 813473 428220 741342  
1171503,483028 1026282 341273 367302 845326 592043 591238 855727 121649 184652 340199 1007275 431367  
1171504,77331 715861 11826 775852 321114 905084 48255  
1171505,1026282 786449 341273 367302 592043 591238 855727 121649 310529 184652 340199 328950
```
- picture_id — идентификатор картинки
- description — описание картинки, закодированое по словам

##### themes.zip

Данный файл содержит закодированную тему картинок.
```
picture_id,themes  
4,19  
5,19  
6,19  
7,19  
8,19  
9,19  
10,19  
11,18  
12,18
```
- picture_id — идентификатор картинки
- themes — набор тем, к которым принадлежит картинка

##### user_proﬁles.zip

Данный файл содержит сжатый профиль пользователей, полученный через онлайн-метрику.
```
user_id,day,embedding  
310618,2019-03-08,0.922 0.078 7.9e-05 0.062491 0.864 0.069111 0.004201 0.000118 0.028006 0.203958 0.320269 0.417098 0.030667  
310618,2019-03-09,0.922 0.078 7.9e-05 0.062491 0.864 0.069111 0.004201 0.000118 0.028006 0.203958 0.320269 0.417098 0.030667  
310618,2019-03-09,0.922 0.078 0.000159 0.034911 0.864 0.093347 0.007302 0.00028 0.030611 0.162368 0.287696 0.47432 0.045003  
310618,2019-03-10,0.922 0.078 0.000159 0.034911 0.864 0.093347 0.007302 0.00028 0.030611 0.162368 0.287696 0.47432 0.045003  
310618,2019-03-11,0.922 0.078 0.000171 0.04258 0.864 0.086733 0.006294 0.000223 0.024575 0.214496 0.304904 0.422807 0.033216  
310618,2019-03-11,0.922 0.078 0.000171 0.04258 0.864 0.086733 0.006294 0.000223 0.024575 0.214496 0.304904 0.422807 0.033216  
310618,2019-03-11,0.922 0.078 0.000123 0.01825 0.864 0.106621 0.010628 0.000378 0.014614 0.16258 0.289733 0.49723 0.03584  
310618,2019-03-12,0.922 0.078 9.8e-05 0.010226 0.864 0.114624 0.01071 0.000341 0.049672 0.253056 0.290702 0.368816 0.037752  
310618,2019-03-13,0.922 0.078 9.8e-05 0.010226 0.864 0.114624 0.01071 0.000341 0.049672 0.253056 0.290702 0.368816 0.037752
```
- user_id — идентификатор пользователя
- day — в какой день была получена информация
- embedding — факторы, отражающие пол, возраст, доход пользователя

##### test_users.zip

В этом файле находятся идентификаторы пользователей, для которых необходимо сделать предсказания.
```
user_id  
103  
178  
1069  
1310  
2108  
2272  
2474  
2501  
2594
```

## Формат вывода
Решения оцениваются по метрике MAP@K (https://yandex.ru/search/?text=mean%20average%20precision%20at%20k), при K равном 100, умноженной на 10000. Релевантными для каждого пользователя считаются те картинки, на которые он кликал в течение последующей недели, за исключением картинок, на которые он кликал ранее. Стоит заметить, что эта метрика не штрафует за лишние предположения, поэтому имеет смысл всегда отправлять 100 самых релевантных картинок.
В качестве ответа нужно посылать файл с двумя колонками:

- user_id — идентификатор пользователя
- predictions — идентификаторы рекомендованных изображений, разделённые пробелом. Каждому пользователя необходимо порекомендовать хотя бы одно изображение.
Пример файла:
```
user_id,predictions  
103,1106272 1183022 1108557
178,1106272 1183022 1164346
1069,1258763 288808 1259132
...
```


## Примечания

Участников, оказавшихся на первых пяти позициях, мы попросим выслать исходный код решения.
Файлы из описания можно взять тут — https://yadi.sk/d/uHe-XpI7pcnZKA
Базовое решение можно взять тут — https://nbviewer.jupyter.org/gist/ld86/dad177461d81f0a14f0a19a9a1021acc
До окончания соревнования лидерборд будет отображать качество посчитанное только на 30% тестовых пользователей. Финальное ранжирование участников будет происходить по оставшимся 70% после окончания соревнования.
Подсчет метрики MAP@K осуществляется с помощью следующих функций:

```python
import numpy as np 
 
def apk(actual, predicted, k=100): 
    """ 
    Computes the average precision at k. 
    This function computes the average prescision at k between two lists of 
    items. 
    Parameters 
    ---------- 
    actual : list 
             A list of elements that are to be predicted (order doesn’t matter) 
    predicted : list 
                A list of predicted elements (order does matter) 
    k : int, optional 
        The maximum number of predicted elements 
    Returns 
    ------- 
    score : double 
            The average precision at k over the input lists 
    """ 
    if len(predicted)>k: 
        predicted = predicted[:k] 
 
    score = 0.0 
    num_hits = 0.0 
 
    for i,p in enumerate(predicted): 
        if p in actual and p not in predicted[:i]: 
            num_hits += 1.0 
            score += num_hits / (i+1.0) 
 
    if not actual: 
        return 0.0 
 
    return score / min(len(actual), k) 
 
def mapk(actual, predicted, k=100): 
    """ 
    Computes the mean average precision at k. 
    This function computes the mean average prescision at k between two lists 
    of lists of items. 
    Parameters 
    ---------- 
    actual : list 
             A list of lists of elements that are to be predicted 
             (order doesn’t matter in the lists) 
    predicted : list 
                A list of lists of predicted elements 
                (order matters in the lists) 
    k : int, optional 
        The maximum number of predicted elements 
    Returns 
    ------- 
    score : double 
            The mean average precision at k over the input lists 
    """ 
    return np.mean([apk(a,p,k) for a,p in zip(actual, predicted)])
 ```
